<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
  <link rel="stylesheet" type="text/css" href="styles.css" />
  <script src="https://cdn.jsdelivr.net/npm/handlebars@latest/dist/handlebars.js"></script>
  <script type="module" src="currencies.js"></script>
  <title>Getting Started</title>
</head>

<body>
  <br /><br />
  <h1 style="text-align: center">Currency Converter</h1>
  </div>
  <div class="hero">
    <div class="button-box">
      <button type="button" id="button-1">
        <i class="fab fa-html5"></i>Inputy
      </button>
      <button type="button" id="button-2">
        <i class="fab fa-css3"></i>Slider
      </button>
    </div>
    <div class="content" id="content-1">
      <div id="contentDiv"></div>
    </div>
    <div class="content" id="content-2">
      <div id="contentSuwakiDiv"></div>
    </div>
    <script id="grocery-template" type="text/x-handlebars-template">
        <div>
          <input type="radio" id="radioInputy1" name="radioInputy" value="similar" onclick="handleChangeMode(this)" checked />
          <label for="radioInputy1">mode where the Euro amount is the same across all the panels with different currencies</label>
        </div>
        <br />
        <div>
          <input type="radio" id="radioInputy2" name="radioInputy" value="unique" onclick="handleChangeMode(this)"/>
          <label for="radioInputy2">mode where the Euro amount/Currency amount is independent</label>
        </div>
        <br />
          {{#each currencies}}
            <form>
              <fieldset class="inputsFieldsets">
                <legend>{{this.name}}</legend>
                <br/>
                <label for="firstInfo">1 Euro is</label>
                <input type="number" class="euroRate" name="euroRate" value="{{this.rate}}" disabled/><span> {{this.name}}</span>

                <br/>
                <br/>
                <label for="euroUniversal">EUR</label>
                <br/>
                <input type="number" min="0" class="euroUniversal" name="euroUniversal" value="100" onchange="changeEuro(this.value)"/>
                <br/>
                <br/>
                <label for="currencyUniversal">{{this.name}}</label><br/>
                <input type="number" min="0" class="currencyUniversal" name="currencyUniversal" onchange="changeCurrency(this.value)"/>
                <br/>
                <br/>
              </fieldset>
              <br/>
              <br/>
            </form>
          {{/each}}
      </script>
    <script id="suwaki-template" type="text/x-handlebars-template">
        <div>
          <input
            type="radio" id="radioSuwaki1" name="radioSuwaki" value="radioSuwaki1" onclick="handleChangeMode(this)" checked 
          />
          <label for="radioSuwaki1">mode where the Euro amount is the same across all the panels with different currencies</label>
        </div>
        <br />
        <div>
          <input type="radio" id="radioSuwaki2" name="radioSuwaki" value="radioSuwaki2" onclick="handleChangeMode(this)"/>
          <label for="radioSuwaki2">mode where the Euro amount/Currency amount is independent</label>
        </div>
        <br />
          {{#each currencies}}
          <form>
            <fieldset class="slidersFieldsets">
              <legend>{{this.name}}</legend>
              <br />
              <label for="firstInfo">2 Euro is</label>
              <input type="number" class="euroRate" name="euroRate" value="{{this.rate}}" disabled/><span> {{this.name}}</span>
              <br/>
              <br/>
              <label for="euroRangeOutput">EUR:</label>
              <output name="euroRangeOutput">24</output><br />
              <br/>
              <input 
                type="range"
                name="euroUniversalSliders"
                class="euroUniversalSliders"
                value="50"
                min="1"
                max="500"
                onchange="changeEuroSliders(this.value)"
              />
              <br />
              <br />
              <label for="currencyRangeOutput">{{this.name}}:</label>
              <output name="currencyRangeOutput">24</output><br />
              <br/>
              <input
                type="range"
                name="currencyUniversalSliders"
                class="currencyUniversalSliders"
                value="50"
                min="1"
                max="500"
                step="1"
                onchange="changeCurrencySliders(this.value)"
              />
              <br/>
              <br/>
            </fieldset>
          </form>
          <br />
          {{/each}}
      </script>
  </div>

  <script type="text/javascript">
    var templateInfo = document.getElementById("grocery-template").innerHTML;
    var template = Handlebars.compile(templateInfo);
    var templateSuwakiInfo = document.getElementById("suwaki-template").innerHTML;
    var templateSuwaki = Handlebars.compile(templateSuwakiInfo);
    var context = {
      currencies: [
        {
          name: "USD",
          rate: 1.25,
        },
        {
          name: "PLN",
          rate: 2,
        },
        {
          name: "CHF",
          rate: 3,
        },
      ],
    };
    var templateData = template(context);
    var templateSuwakiData = templateSuwaki(context);
    document.getElementById("contentDiv").innerHTML += templateData;
    document.getElementById("contentSuwakiDiv").innerHTML += templateSuwakiData;

    var euroRate = document.querySelectorAll('.euroRate');

    var elmsEuroUniversal = document.querySelectorAll(".euroUniversal");
    var elmsEuroUniversalSliders = document.querySelectorAll(".euroUniversalSliders");

    var elmsCurrencyUniversal = document.querySelectorAll(".currencyUniversal");
    var elmsCurrencyUniversalSliders = document.querySelectorAll(".currencyUniversalSliders");

    var elmsEuroRangeOutput = document.querySelectorAll('output[name="euroRangeOutput"]');
    var elmsCurrencyRangeOutput = document.querySelectorAll('output[name="currencyRangeOutput"]');

    var flagAll = 'similar';

    for (let i = 0; i < elmsCurrencyUniversal.length; i++) {
      elmsCurrencyUniversal[i].value = elmsEuroUniversal[i].value * context.currencies[i].rate;
    }

    function rangeEuro() {
      var x = document.getElementById("myRange").value;
      document.getElementById("demo").innerHTML = x;
    }

    var inputsFieldsets = document.querySelectorAll('.inputsFieldsets')
    var slidersFieldsets = document.querySelectorAll('.slidersFieldsets')


    function individualChange() {
      inputsFieldsets.forEach(element => {
        const currency = element.querySelector('input[name="currencyUniversal"]');
        const euro = element.querySelector('input[name="euroUniversal"]');
        const euroRate = element.querySelector('input[name="euroRate"]').value;
        
        euro.addEventListener('input', () => {
          currency.value = euro.value * euroRate;
        })
        currency.addEventListener('input', () => {
          euro.value = currency.value / euroRate;
        })
      });
    }

    function individualChangeForSliders() {
      slidersFieldsets.forEach(element => {
        const currency = element.querySelector('input[name="currencyUniversalSliders"]');
        const euro = element.querySelector('input[name="euroUniversalSliders"]');
        const euroRate = element.querySelector('input[name="euroRate"]').value;
        const outputEuro = element.querySelector('output[name="euroRangeOutput"]');
        const outputCurrency = element.querySelector('output[name="currencyRangeOutput"]');

        euro.addEventListener('input', () => {
          currency.value = euro.value * euroRate;
        })
        currency.addEventListener('input', () => {
          euro.value = currency.value / euroRate;
        })

        outputEuro.innerHTML = currency.value;
        outputCurrency.innerHTML = euro.value;
      });
    }

    function handleChangeMode(myRadio) {
      flagAll = myRadio.value;
      console.log('flagAll', flagAll);
    }

    function changeEuro(val) {
      if (flagAll === 'similar') {
        for (let i = 0; i < elmsEuroUniversal.length; i++) {
          elmsEuroUniversal[i].value = val;
        }
        for (let i = 0; i < elmsCurrencyUniversal.length; i++) {
          elmsCurrencyUniversal[i].value = elmsEuroUniversal[i].value * context.currencies[i].rate;
        }
      } else {  //(flagAll === 'uniqueRadio')
        individualChange();
      }
    }

    function changeEuroSliders(val) {
      if (flagAll === 'similar') {
        for (let i = 0; i < elmsEuroUniversalSliders.length; i++) {
          elmsEuroUniversalSliders[i].value = val;
          elmsEuroRangeOutput[i].innerHTML = elmsEuroUniversalSliders[i].value;
          elmsCurrencyRangeOutput[i].innerHTML = elmsCurrencyUniversalSliders[i].value;
        }
        for (let i = 0; i < elmsCurrencyUniversalSliders.length; i++) {
          elmsCurrencyUniversalSliders[i].value = elmsEuroUniversalSliders[i].value * context.currencies[i].rate;
        }
      } else {  //(flagAll === 'uniqueRadio')
        individualChangeForSliders();
      }
    }

    function changeCurrency(val) {
      if (flagAll === 'similar') {
        for (let i = 0; i < elmsCurrencyUniversal.length; i++) {
          elmsCurrencyUniversal[i].value = val;
        }
        for (var i = 0; i < elmsEuroUniversal.length; i++) {
          elmsEuroUniversal[i].innerHTML = elmsCurrencyUniversal[i].value / context.currencies[i].rate;
        }
      } else { //(flagAll === 'uniqueRadio')
        individualChange();
      }
    }

    function changeCurrencySliders(val) {
      if (flagAll === 'similar') {
        for (let i = 0; i < elmsCurrencyUniversalSliders.length; i++) {
          elmsCurrencyUniversalSliders[i].value = val;
          elmsCurrencyRangeOutput[i].innerHTML = elmsCurrencyUniversalSliders[i].value;
          elmsEuroRangeOutput[i].innerHTML = elmsEuroUniversalSliders[i].value;
        }
        for (var i = 0; i < elmsEuroUniversalSliders.length; i++) {
          elmsEuroUniversalSliders[i].value = elmsCurrencyUniversalSliders[i].value / context.currencies[i].rate;
        }
      } else { //(flagAll === 'uniqueRadio')
        individualChangeForSliders();
      }
    }

    // function Currency() {
    //   y = document.getElementById("converter").value;
    //   return y;
    // }
    // function Calculate() {
    //   y = Currency();
    // }

  </script>
  <script src="bundle.js"></script>
  <script>
    const button1 = document.getElementById("button-1");
    const button2 = document.getElementById("button-2");
    const content1 = document.getElementById("content-1");
    const content2 = document.getElementById("content-2");
    button1.onclick = function openHTML() {
      content1.style.transform = "translateX(80%)"; //show inputs
      content2.style.transform = "translateX(-200%)"; //hide sliders
      content1.style.transitionDelay = "0.3s";
      content2.style.transitionDelay = "0s";
      button1.style.color = "#ff7846";
      button2.style.color = "#000";
    };
    button2.onclick = function openCSS() { //sliders click - hide inputs and show sliders
      content1.style.transform = "translateX(-200%)"; //hide inputs
      content2.style.transform = "translateX(200%)";
      content1.style.transitionDelay = "0s";
      content2.style.transitionDelay = "0.3s";
      button2.style.color = "#ff7846";
      button1.style.color = "#000";
    };
  </script>
</body>

</html>